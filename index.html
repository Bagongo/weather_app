<!DOCTYPE html>

<html>
<title>Weather-APP</title>    
    
<head> 

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    
    <script src="https://use.fontawesome.com/c4baa82464.js"></script>        
    <script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>    
</head>

<style>
    
    body{
        background-image: url("https://wallpaperscraft.com/image/sky_field_gloomy_dark_blue_gleam_bad_weather_53978_2048x1152.jpg");  
        background-position: center;  
        background-repeat: no-repeat;
        background-attachment: fixed;  
        background-size: cover;
    }
    
    .margin-top{
        margin-top: 25px;
    }
  
    #flex-container{
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    
    #head-cont{
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        width: 70%;
        height: 50px;
        background-color: azure;
    }
    
    #data-box-cont{
        width: 50%;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap-reverse;
        justify-content: space-around;
    }
    
    #data-box-cont > div{
        display: flex;
        justify-content: center;
        align-items: center;
        width: 150px;
        height: 100px;
        border-radius: 15px;
        margin: 15px;
        background-color: azure;
    }
    
    #search-bar-cont{
        width: 70%;
        height: 50px;
        background-color: azure;
    }
    
    #refresh-btn{
        position: relative;
        width: 70px;
        height: auto;
        padding: 5px 0;
        border-radius: 10px;
        border: 4px solid #1442be;
        background-color: azure;
    }
    
    #refresh-btn > p{
        text-align: center;
        margin: 0;
        font-size: 0.7em;
        color: #1442be;
    }
    
    #refresh-btn .bar:nth-child(1){
        width: 40px;
        height: 8px;
    }
    
    #refresh-btn .bar:nth-child(2){
        background-color: #5078e5;
        width: 25px;
        height: 7px;
    }
    
    #refresh-btn .bar:nth-child(3){
        width: 15px;
    }
    
    #refresh-btn .bar:nth-child(4){       
        height: 0px;
        width: 0px;
        margin-top: 3px;
        border: 5px solid #5078e5;
        border-bottom: 5px solid transparent;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        background-color: transparent;
    }
    
    .bar{
        position: relative;
        height: 5px;
        border-radius: 4px;
        background-color: #1442be;
        margin: 2px auto;        
    }
    
    .bar.twist{
        animation: twitsting 1s alternate;
        animation-iteration-count: 5;        
    }
       
    .bar.twist-reverse{
        animation: twitsting 1s alternate-reverse;
        animation-iteration-count: 5;
    }
    
    @-webkit-keyframes twitsting {
        from {left: -1px;}
        to {left: 1px;}
    }

    @keyframes twitsting {
        from {left: -1px;}
        to {left: 1px;}
    }
       
    @media all and (max-width: 1100px) {
        #icon{order: 3;}
    }
    
    @media all and (max-width: 768px) {
        #head-cont{width: 90%; height: 100px};
        #weather{order: 2;}
        #temp{order: 1};
    }
    

</style>

<body>
    
    <div id="flex-container">
        
        <div id="head-cont" class="margin-top">
            <h3>The current weather in: </h3>
            <h4></h4>
        </div>
        
        <div id="data-box-cont" class="margin-top">
            <div id="weather"><p></p></div>
            <div id="icon"><img src="" /></div>
            <div id="temp"><p></p></div>       
        </div>
        
        <div id="search-bar-cont" class="margin-top"></div>
        
        <div id="refresh-btn" class="margin-top">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <p>Get weather</p>
        </div>
       
        
    </div>
    

    <script>        
        
    $(window).on("load", function(){
        
        var geok = "91eb7c81e4675bcb";        
        var location = {};
        var weatherData = {};
        
    
        $("#refresh-btn").click(function(){
                
                //getLocation();
            
                $(this).children().eq(0).addClass("twist");
                $(this).children().eq(1).addClass("twist-reverse");
                $(this).children().eq(2).addClass("twist");
                $(this).children().eq(3).addClass("twist-reverse");
              
                var newone = $(this).clone(true);
                $(this).before(newone);        
                $("." + $(this).attr("class") + ":last").remove();
        });
              
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getLatLong, altGetLatLong);
            } 
            else
            {
                //handle errors here;
            }
        }
        
        function getLatLong(position) {
            
            var latLong = position.coords.latitude.toString() + "," + position.coords.longitude.toString();
            reverseGeoCode(latLong);
        }
        
        function altGetLatLong(error) {
                                    
            $.get("http://ipinfo.io", function(response) {
                var latLong = response.loc;
                reverseGeoCode(latLong);
            }, "jsonp")           
        }
                       
        function reverseGeoCode(latlong){
                     
             var queryLocation = "http://api.wunderground.com/api/"+geok+"/geolookup/q/"+latlong+".json";
            
             $.get(queryLocation, function(data){
                location.country = data.location.country_iso3166;
                location.city = data.location.city;
                getWeather(location);
            });
        }
        
        function getWeather(location)
        {
            var queryCond = "http://api.wunderground.com/api/"+geok+"/conditions/q/"+location.country+"/"+location.city+".json";
            
            $.get(queryCond, function(data){                
                weatherData.condition = data.current_observation.weather;
                weatherData.temps = {
                                     F : data.current_observation.temp_f + " F",
                                     C : data.current_observation.temp_c + " C"
                                    }
                weatherData.pic = data.current_observation.icon_url.toString();
                fillDataFields();
            });
            
        }
        
        function fillDataFields()
        {
            $("#head-cont > h4").html(location.city + ", " + location.country);
            console.log(weatherData);
            $("#icon > img").attr("src", weatherData.pic);
            $("#weather > p").html(weatherData.condition);
            $("#temp > p").html(weatherData.temps.F);
        }
        
        getLocation();
            
    });


    </script>
    
</body>
    
</html>